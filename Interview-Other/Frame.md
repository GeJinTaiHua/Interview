## 💦架构

  * [系统](#系统)
    * [系统可用性](#系统可用性)
    * [](#)
 

### 系统
#### 系统可用性
+ 重要指标：
  + MTTF：平均无故障时间。指系统无故障运行的平均时间，取所有从系统开始正常运行到发生故障之间的时间段的平均值。
  + MTTR：平均修复时间。指系统从发生故障到维修结束之间的时间段的平均值。
  + MTBF：平均失效间隔。指系统两次故障发生时间之间的时间段的平均值。  
```
MTBF = MTTF + MTTR
```
```
系统的可用性 = MTTF / MTBR * 100% = MTTF / ( MTTF + MTTR ) * 100%
```
+ 衡量指标：
  + SLA：意思是服务等级协议。

| 描述 | 通俗叫法 | 可用性级别 | 年度宕机时间 | 每天宕机时间 | |
|---|---|---|---|---|---| 
|可用|1个9|90%|36.5d|2.4h| | 
|基本可用性|2个9|99%|87.6h|14min| | 
|较高可用性|3个9|99.9%|8.76h|86s| | 
|具有故障自动回复能力|4个9|99.99%|52.6min|8.6s|淘宝、JD| 
|极高可用性|5个9|99.999%|5.25min|0.86s| | 

+ 可用性的保障：

| 问题 | 典型案例 | 增大MTBF | 减小MTTR | 
|---|---|---|---|
|程序配置bug|程序配置bug|提升研发、测试质量，灰度发布|监控报告、快速回滚|
|机器、机房故障|宕机、机房断电|硬件冗余、多机房|自动故障转移，切换到其他冗余机器、机房|
|突发流量|上游系统异常重试、外部攻击|上游系统容错调度防雪崩、流量配额、防攻击、防抓取|其他同容量不足|
|容量不足|主流程容量不足|容量归化、容量预警|限流、降级、熔断弱依赖、快速扩容|
|依赖服务器故障|依赖服务失败率高、超时严重|弱依赖降级解耦、强依赖递归使用前述方法可靠性|熔断弱依赖|

