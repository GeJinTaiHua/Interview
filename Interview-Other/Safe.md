## ❗安全

  * [缓存](#%E7%BC%93%E5%AD%98)
    * [缓存穿透](#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F)
    * [缓存雪崩](#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9)
  * [内存](#%E5%86%85%E5%AD%98)
    * [内存溢出（out of memory）](#%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BAout-of-memory)
    * [内存泄漏（memory leak）](#%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8Fmemory-leak)
  * [攻击](#%E6%94%BB%E5%87%BB)
    * [重放攻击](#%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB)
    * [文件上传漏洞攻击](#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB)
  * [防御](#%E9%98%B2%E5%BE%A1)
    * [实名认证](#%E5%AE%9E%E5%90%8D%E8%AE%A4%E8%AF%81)

### 缓存
#### 缓存穿透
+ 查询一个一定不存在的数据，由于缓存是不命中时需要从数据库查询，查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到数据库去查询；
+ 解决办法：
  1) 布隆过滤器，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃；
  2) 如果一个查询返回的数据为空，我们仍然把这个空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。
  
#### 缓存雪崩
+ 如果缓存集中在一段时间内失效，发生大量的缓存穿透，所有的查询都落在数据库上，造成了缓存雪崩;
+ 解决方法：
  1) 事前：redis 高可用，主从+哨兵，redis cluster，避免全盘崩溃。
  2) 事中：本地 ehcache 缓存 + hystrix 限流&降级，避免 MySQL 被打死。
  3) 事后：redis 持久化，一旦重启，自动从磁盘上加载数据，快速恢复缓存数据。

### 内存
#### 内存溢出（out of memory）
+ 程序在申请内存时，没有足够的内存空间供其使用。

#### 内存泄漏（memory leak）
+ 程序在申请内存后，无法释放已申请的内存空间。
+ java 容易引起内存泄漏时机：
  + 静态集合类（HashMap、ThreadLocal等）；
  + 各种连接（数据库连接，网络连接，IO连接等）未调用close关闭；
  + 监听器，在释放对象的同时没有删除对应监听器；
  + 内部类和外部模块的引用；
  + 不正确的单例。
  
### 攻击
#### 重放攻击
+ 定义：又称重播攻击、回放攻击，是指攻击者发送一个目的主机已接收过的包，来达到欺骗系统的目的，主要用于身份认证过程，破坏认证的正确性。
+ 防御方案：
  1) 加随机数：需要额外保存使用过的随机数；
  2) 加时间戳；
  3) 加流水号；
  4) 挑战一应答机制；
  5) 一次性口令机制。
  
#### 文件上传漏洞攻击
+ 定义：用户上传了一个可执行的脚本文件，并通过此脚本文件获得了执行服务器端命令的能力。
+ 防御方案：
  1) 将文件上传目录直接设置为不可执行；
  2) 文件类型检查：白名单方式，结合MIME Type、后缀检查等方式；
  3) 图片处理：使用压缩函数或resize函数，处理图片的同时破坏其包含的HTML代码；
  4) 使用随机数改写文件名和文件路径，使得用户不能轻易访问自己上传的文件；
  5) 单独设置文件服务器的域名。
  
### 防御  
#### 实名认证
+ 身份证实名认证：系统强制用户注册时填写个人的姓名和身份证号码，通调用第三方接口核验身份证号和姓名是否一致。
+ 手机号实名认证：调用第三方接口确认填写的身份证信息是不是该手机号在运营商办理时使用的身份证。
+ 银行卡实名认证

